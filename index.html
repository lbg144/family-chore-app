<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Family Chore Manager</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Chore Manager">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 428px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 60px 20px 30px 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .notification-btn {
            position: absolute;
            top: 70px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            cursor: pointer;
            border: none;
            color: white;
        }

        .main-content {
            padding: 20px;
            padding-bottom: 100px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px 15px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 15px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: '';
            width: 3px;
            height: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            background: white;
            -webkit-appearance: none;
            appearance: none;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
            touch-action: manipulation;
        }

        .btn:active {
            transform: scale(0.98);
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        .btn-small {
            padding: 10px 16px;
            font-size: 14px;
            width: auto;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
        }

        .btn-photo {
            background: linear-gradient(135deg, #ffa726 0%, #ff7043 100%);
            margin-top: 10px;
        }

        .family-members {
            display: grid;
            gap: 15px;
        }

        .member-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .member-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .member-name {
            font-size: 1.2em;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .member-role {
            background: rgba(255,255,255,0.8);
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.8em;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 10px;
        }

        .member-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            font-size: 0.9em;
            color: #666;
            margin-bottom: 15px;
        }

        .chores-list {
            display: grid;
            gap: 15px;
        }

        .chore-item {
            background: white;
            padding: 20px;
            border-radius: 16px;
            border-left: 4px solid #667eea;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .chore-item.completed {
            border-left-color: #4ecdc4;
            background: #f0fffe;
        }

        .chore-item.overdue {
            border-left-color: #ff6b6b;
            background: #fff5f5;
        }

        .chore-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .chore-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 0.85em;
            color: #666;
            margin-bottom: 15px;
        }

        .chore-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .completion-photo {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
            border: 2px solid #4ecdc4;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .role-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        .hidden-input {
            position: absolute;
            left: -9999px;
            opacity: 0;
        }

        .hidden {
            display: none !important;
        }

        .week-progress {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .week-progress h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.9em;
            color: #666;
            text-align: center;
        }

        .notifications-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
        }

        .notifications-content {
            position: absolute;
            top: 100px;
            left: 20px;
            right: 20px;
            max-height: calc(100vh - 120px);
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .notifications-header {
            padding: 20px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .notifications-list {
            max-height: calc(100vh - 220px);
            overflow-y: auto;
        }

        .notification-item {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .notification-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .notification-message {
            color: #666;
            margin-bottom: 5px;
        }

        .notification-time {
            font-size: 0.8em;
            color: #999;
        }

        .info-box {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            font-size: 0.9em;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>🏠 Family Chores</h1>
            <p>Smart chore management for busy families</p>
            <button class="notification-btn" id="notificationBtn">🔔</button>
        </div>

        <div class="main-content">
            <!-- Stats Section -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalChores">0</div>
                    <div class="stat-label">Total Chores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedChores">0</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="overdueChores">0</div>
                    <div class="stat-label">Overdue</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="familyMembers">0</div>
                    <div class="stat-label">Family</div>
                </div>
            </div>

            <!-- Week Progress -->
            <div class="week-progress">
                <h3>📅 This Week's Progress</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="weekProgressFill"></div>
                </div>
                <div class="progress-text" id="weekProgressText">0% Complete</div>
            </div>

            <!-- Role Selection -->
            <div class="section" id="roleSection">
                <h2 class="section-title">Choose Your Role</h2>
                <div class="form-row">
                    <button class="btn" id="parentBtn">👨‍👩‍👧‍👦 Parent Admin</button>
                    <button class="btn" id="childBtn">👶 Child</button>
                </div>
                <div class="info-box">
                    <strong>Note:</strong> Only Parent Admins can invite other family members and manage chores. Children can only complete assigned chores.
                </div>
            </div>

            <!-- Family Invitations Section (Parent Only) -->
            <div class="section hidden" id="inviteSection">
                <h2 class="section-title">Invite Family Members</h2>
                <div class="form-group">
                    <input type="text" id="inviteName" placeholder="Family member name" />
                </div>
                <div class="form-group">
                    <select id="inviteRole">
                        <option value="child">Child</option>
                        <option value="parent">Parent (Admin)</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="tel" id="invitePhone" placeholder="Phone number (e.g., +1234567890)" />
                </div>
                <div class="form-row">
                    <button class="btn" id="sendInviteBtn">📱 Send Text Invite</button>
                    <button class="btn" id="addDirectBtn">➕ Add Directly</button>
                </div>
                <div class="info-box">
                    Text invite will send them a link to join your family chore app
                </div>
            </div>

            <!-- Add Family Member Section (Parent Only) -->
            <div class="section hidden" id="addMemberSection">
                <h2 class="section-title">Manually Add Family Member</h2>
                <div class="form-group">
                    <input type="text" id="memberName" placeholder="Enter family member name" />
                </div>
                <div class="form-group">
                    <select id="memberRole">
                        <option value="child">Child</option>
                        <option value="parent">Parent (Admin)</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="email" id="memberEmail" placeholder="Email for notifications (optional)" />
                </div>
                <button class="btn" id="addMemberBtn">Add Member</button>
            </div>

            <!-- Family Members Section -->
            <div class="section">
                <h2 class="section-title">Family Members</h2>
                <div class="family-members" id="familyMembersList">
                    <div class="empty-state">
                        <h3>No family members added yet</h3>
                        <p>Add family members to get started</p>
                    </div>
                </div>
            </div>

            <!-- Add Chore Section (Parent Only) -->
            <div class="section hidden" id="addChoreSection">
                <h2 class="section-title">Add New Chore</h2>
                <div class="form-group">
                    <input type="text" id="choreTitle" placeholder="Chore title" />
                </div>
                <div class="form-group">
                    <select id="choreAssignee">
                        <option value="">Select child to assign chore</option>
                    </select>
                </div>
                <div class="form-row">
                    <select id="chorePriority">
                        <option value="low">Low Priority</option>
                        <option value="medium">Medium Priority</option>
                        <option value="high">High Priority</option>
                    </select>
                    <select id="choreFrequency">
                        <option value="once">One Time</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                    </select>
                </div>
                <div class="form-row">
                    <input type="date" id="choreDueDate" />
                    <input type="time" id="choreStartTime" />
                </div>
                <div class="form-group">
                    <input type="number" id="reminderInterval" placeholder="Reminder interval (minutes)" value="60" min="15" max="240" />
                </div>
                <button class="btn" id="addChoreBtn">Add Chore</button>
            </div>

            <!-- Chores List Section -->
            <div class="section">
                <h2 class="section-title">Current Chores</h2>
                <div class="chores-list" id="choresList">
                    <div class="empty-state">
                        <h3>No chores assigned yet</h3>
                        <p>Add some chores to get started</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Role Indicator -->
        <div class="role-indicator" id="roleIndicator">
            Current Role: <span id="currentRole"></span>
        </div>
    </div>

    <!-- Hidden file input for camera -->
    <input type="file" id="cameraInput" class="hidden-input" accept="image/*" capture="environment">

    <!-- Notifications Panel -->
    <div class="notifications-panel" id="notificationsPanel">
        <div class="notifications-content">
            <div class="notifications-header">
                <span>📢 Notifications</span>
                <button class="close-btn" id="closeNotifications">×</button>
            </div>
            <div class="notifications-list" id="notificationsList">
                <div style="padding: 20px; text-align: center; color: #666;">No notifications yet</div>
            </div>
        </div>
    </div>

    <script>
        // App data
        var appData = {
            familyMembers: [],
            chores: [],
            notifications: [],
            userRole: null,
            currentChoreForPhoto: null,
            isAdmin: false,
            invitations: []
        };

        // DOM elements
        var elements = {
            parentBtn: document.getElementById('parentBtn'),
            childBtn: document.getElementById('childBtn'),
            roleSection: document.getElementById('roleSection'),
            roleIndicator: document.getElementById('roleIndicator'),
            currentRole: document.getElementById('currentRole'),
            inviteSection: document.getElementById('inviteSection'),
            addMemberSection: document.getElementById('addMemberSection'),
            addChoreSection: document.getElementById('addChoreSection'),
            addMemberBtn: document.getElementById('addMemberBtn'),
            addChoreBtn: document.getElementById('addChoreBtn'),
            sendInviteBtn: document.getElementById('sendInviteBtn'),
            addDirectBtn: document.getElementById('addDirectBtn'),
            notificationBtn: document.getElementById('notificationBtn'),
            closeNotifications: document.getElementById('closeNotifications'),
            notificationsPanel: document.getElementById('notificationsPanel'),
            memberName: document.getElementById('memberName'),
            memberRole: document.getElementById('memberRole'),
            memberEmail: document.getElementById('memberEmail'),
            inviteName: document.getElementById('inviteName'),
            inviteRole: document.getElementById('inviteRole'),
            invitePhone: document.getElementById('invitePhone'),
            choreTitle: document.getElementById('choreTitle'),
            choreAssignee: document.getElementById('choreAssignee'),
            chorePriority: document.getElementById('chorePriority'),
            choreFrequency: document.getElementById('choreFrequency'),
            choreDueDate: document.getElementById('choreDueDate'),
            choreStartTime: document.getElementById('choreStartTime'),
            reminderInterval: document.getElementById('reminderInterval'),
            familyMembersList: document.getElementById('familyMembersList'),
            choresList: document.getElementById('choresList'),
            totalChores: document.getElementById('totalChores'),
            completedChores: document.getElementById('completedChores'),
            overdueChores: document.getElementById('overdueChores'),
            familyMembers: document.getElementById('familyMembers'),
            weekProgressFill: document.getElementById('weekProgressFill'),
            weekProgressText: document.getElementById('weekProgressText'),
            notificationsList: document.getElementById('notificationsList'),
            cameraInput: document.getElementById('cameraInput')
        };

        // Event listeners
        function setupEventListeners() {
            if (elements.parentBtn) {
                elements.parentBtn.addEventListener('click', function() {
                    setUserRole('parent');
                });
            }

            if (elements.childBtn) {
                elements.childBtn.addEventListener('click', function() {
                    setUserRole('child');
                });
            }

            if (elements.addMemberBtn) {
                elements.addMemberBtn.addEventListener('click', addFamilyMember);
            }

            if (elements.addChoreBtn) {
                elements.addChoreBtn.addEventListener('click', addChore);
            }

            if (elements.sendInviteBtn) {
                elements.sendInviteBtn.addEventListener('click', sendTextInvite);
            }

            if (elements.addDirectBtn) {
                elements.addDirectBtn.addEventListener('click', function() {
                    if (elements.addMemberSection) {
                        elements.addMemberSection.classList.remove('hidden');
                    }
                    if (elements.inviteSection) {
                        elements.inviteSection.classList.add('hidden');
                    }
                });
            }

            if (elements.notificationBtn) {
                elements.notificationBtn.addEventListener('click', toggleNotifications);
            }

            if (elements.closeNotifications) {
                elements.closeNotifications.addEventListener('click', hideNotifications);
            }

            if (elements.cameraInput) {
                elements.cameraInput.addEventListener('change', handlePhotoCapture);
            }

            if (elements.notificationsPanel) {
                elements.notificationsPanel.addEventListener('click', function(e) {
                    if (e.target === elements.notificationsPanel) {
                        hideNotifications();
                    }
                });
            }
        }

        function setUserRole(role) {
            appData.userRole = role;
            appData.isAdmin = (role === 'parent');
            
            if (elements.roleSection) {
                elements.roleSection.classList.add('hidden');
            }
            
            if (elements.roleIndicator) {
                elements.roleIndicator.style.display = 'block';
            }
            
            if (elements.currentRole) {
                var roleText = role === 'parent' ? 'Parent Admin' : 'Child';
                elements.currentRole.textContent = roleText;
            }
            
            if (role === 'parent') {
                if (elements.inviteSection) {
                    elements.inviteSection.classList.remove('hidden');
                }
                if (elements.addChoreSection) {
                    elements.addChoreSection.classList.remove('hidden');
                }
            }
            
            addNotification('Welcome!', 'You are logged in as a ' + (role === 'parent' ? 'Parent Admin' : 'Child'), 'info');
            updateStats();
            renderFamilyMembers();
            renderChores();
        }

        function sendTextInvite() {
            var name = elements.inviteName.value.trim();
            var role = elements.inviteRole.value;
            var phone = elements.invitePhone.value.trim();
            
            if (!name) {
                alert('Please enter a name');
                return;
            }
            
            if (!phone) {
                alert('Please enter a phone number');
                return;
            }
            
            var cleanPhone = phone.replace(/[^\d+]/g, '');
            
            var invitation = {
                id: Date.now(),
                name: name,
                role: role,
                phone: cleanPhone,
                invited: new Date().toISOString(),
                accepted: false
            };
            
            appData.invitations.push(invitation);
            
            var appUrl = window.location.origin + window.location.pathname;
            var roleText = role === 'parent' ? 'Parent Admin' : 'Child';
            
            var message = 'Hi ' + name + '! You\'ve been invited to join our Family Chore Manager as a ' + roleText + '. ' +
                'Install the app: ' + appUrl + ' ' +
                'Then tap "Add to Home Screen" in Safari to install it like an app. ' +
                'Your invite code: ' + invitation.id;
            
            var smsUrl = 'sms:' + cleanPhone + '?&body=' + encodeURIComponent(message);
            
            try {
                window.location.href = smsUrl;
                elements.inviteName.value = '';
                elements.invitePhone.value = '';
                addNotification('Invite Sent!', 'Text invitation sent to ' + name + ' (' + phone + ')', 'success');
                
                setTimeout(function() {
                    alert('Text invitation sent to ' + name + '!\n\nThey will receive:\n- App link\n- Installation instructions\n- Invite code: ' + invitation.id);
                }, 500);
                
            } catch (error) {
                copyToClipboard(message);
                alert('SMS not available. Message copied to clipboard!\n\nPlease paste and send this text to ' + name + ' (' + phone + '):\n\n' + message);
            }
        }

        function copyToClipboard(text) {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text);
            } else {
                var textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                document.execCommand('copy');
                textArea.remove();
            }
        }

        function addFamilyMember() {
            if (!appData.isAdmin) {
                alert('Only Parent Admins can add family members');
                return;
            }
            
            var name = elements.memberName.value.trim();
            var role = elements.memberRole.value;
            var email = elements.memberEmail.value.trim();
            
            if (!name) {
                alert('Please enter a family member name');
                return;
            }

            for (var i = 0; i < appData.familyMembers.length; i++) {
                if (appData.familyMembers[i].name === name) {
                    alert('Family member already exists');
                    return;
                }
            }

            var member = {
                id: Date.now(),
                name: name,
                role: role,
                email: email,
                totalChores: 0,
                completedChores: 0,
                isAdmin: (role === 'parent')
            };

            appData.familyMembers.push(member);
            
            elements.memberName.value = '';
            elements.memberEmail.value = '';
            
            if (elements.addMemberSection) {
                elements.addMemberSection.classList.add('hidden');
            }
            if (elements.inviteSection) {
                elements.inviteSection.classList.remove('hidden');
            }
            
            updateStats();
            renderFamilyMembers();
            updateAssigneeDropdown();
            addNotification('Family Update', name + ' has been added to the family as a ' + (role === 'parent' ? 'Parent Admin' : 'Child') + '!', 'success');
        }

        function addChore() {
            if (!appData.isAdmin) {
                alert('Only Parent Admins can create chores');
                return;
            }
            
            var title = elements.choreTitle.value.trim();
            var assigneeId = elements.choreAssignee.value;
            var priority = elements.chorePriority.value;
            var dueDate = elements.choreDueDate.value;
            var startTime = elements.choreStartTime.value;
            var frequency = elements.choreFrequency.value;
            var reminderInterval = parseInt(elements.reminderInterval.value) || 60;

            if (!title) {
                alert('Please enter a chore title');
                return;
            }

            if (!dueDate) {
                alert('Please select a due date');
                return;
            }

            if (!assigneeId) {
                alert('Please select a child to assign the chore to');
                return;
            }

            var assignee = null;
            for (var i = 0; i < appData.familyMembers.length; i++) {
                if (appData.familyMembers[i].id == assigneeId) {
                    assignee = appData.familyMembers[i];
                    break;
                }
            }
            
            if (assignee && assignee.role === 'parent') {
                alert('Chores can only be assigned to children');
                return;
            }
            
            var chore = {
                id: Date.now(),
                title: title,
                assigneeId: assigneeId,
                assigneeName: assignee ? assignee.name : 'Unassigned',
                priority: priority,
                dueDate: dueDate,
                startTime: startTime || '09:00',
                frequency: frequency,
                reminderInterval: reminderInterval,
                completed: false,
                createdAt: new Date().toISOString(),
                createdBy: appData.userRole
            };

            appData.chores.push(chore);
            
            if (assignee) {
                assignee.totalChores++;
            }

            elements.choreTitle.value = '';
            elements.choreAssignee.value = '';
            elements.chorePriority.value = 'low';
            elements.choreStartTime.value = '';
            elements.choreFrequency.value = 'once';
            elements.reminderInterval.value = '60';

            updateStats();
            renderChores();
            renderFamilyMembers();
            
            if (assignee) {
                addNotification('New Chore', title + ' has been assigned to ' + assignee.name, 'info');
            }
        }

        function toggleChore(choreId) {
            var chore = null;
            for (var i = 0; i < appData.chores.length; i++) {
                if (appData.chores[i].id === choreId) {
                    chore = appData.chores[i];
                    break;
                }
            }
            
            if (!chore) return;

            if (appData.userRole === 'child' && !chore.completed) {
                takeCompletionPhoto(choreId);
                return;
            }

            chore.completed = !chore.completed;
            
            var member = null;
            for (var i = 0; i < appData.familyMembers.length; i++) {
                if (appData.familyMembers[i].id === chore.assigneeId) {
                    member = appData.familyMembers[i];
                    break;
                }
            }
            
            if (member) {
                if (chore.completed) {
                    member.completedChores++;
                } else {
                    member.completedChores--;
                }
            }
            
            updateStats();
            renderChores();
            renderFamilyMembers();
            checkWeeklyCompletion();
        }

        function takeCompletionPhoto(choreId) {
            appData.currentChoreForPhoto = choreId;
            if (elements.cameraInput) {
                elements.cameraInput.click();
            }
        }

        function handlePhotoCapture(event) {
            var file = event.target.files[0];
            if (!file || !appData.currentChoreForPhoto) return;

            var reader = new FileReader();
            reader.onload = function(e) {
                var photoData = e.target.result;
                completeChoreWithPhoto(appData.currentChoreForPhoto, photoData);
                appData.currentChoreForPhoto = null;
            };
            reader.readAsDataURL(file);
        }

        function completeChoreWithPhoto(choreId, photoData) {
            var chore = null;
            for (var i = 0; i < appData.chores.length; i++) {
                if (appData.chores[i].id === choreId) {
                    chore = appData.chores[i];
                    break;
                }
            }
            if (!chore) return;

            chore.completed = true;
            chore.completionPhoto = photoData;
            chore.completedAt = new Date().toISOString();

            var member = null;
            for (var i = 0; i < appData.familyMembers.length; i++) {
                if (appData.familyMembers[i].id === chore.assigneeId) {
                    member = appData.familyMembers[i];
                    break;
                }
            }
            
            if (member) {
                member.completedChores++;

                var parents = [];
                for (var i = 0; i < appData.familyMembers.length; i++) {
                    if (appData.familyMembers[i].role === 'parent') {
                        parents.push(appData.familyMembers[i]);
                    }
                }
                
                for (var i = 0; i < parents.length; i++) {
                    addNotification(
                        '✅ ' + chore.title + ' Complete!',
                        member.name + ' finished: ' + chore.title,
                        'completion',
                        photoData
                    );
                }
            }

            updateStats();
            renderChores();
            renderFamilyMembers();
            checkWeeklyCompletion();
        }

        function removeFamilyMember(id) {
            if (!appData.isAdmin) {
                alert('Only Parent Admins can remove family members');
                return;
            }
            
            if (confirm('Are you sure you want to remove this family member?')) {
                var member = null;
                for (var i = 0; i < appData.familyMembers.length; i++) {
                    if (appData.familyMembers[i].id === id) {
                        member = appData.familyMembers[i];
                        break;
                    }
                }
                
                appData.familyMembers = appData.familyMembers.filter(function(m) {
                    return m.id !== id;
                });
                
                for (var i = 0; i < appData.chores.length; i++) {
                    if (appData.chores[i].assigneeId === id) {
                        appData.chores[i].assigneeId = null;
                        appData.chores[i].assigneeName = 'Unassigned';
                    }
                }
                
                updateStats();
                renderFamilyMembers();
                renderChores();
                updateAssigneeDropdown();
                
                if (member) {
                    addNotification('Family Update', member.name + ' has been removed from the family', 'info');
                }
            }
        }

        function deleteChore(id) {
            if (!appData.isAdmin) {
                alert('Only Parent Admins can delete chores');
                return;
            }

            if (confirm('Are you sure you want to delete this chore?')) {
                var chore = null;
                for (var i = 0; i < appData.chores.length; i++) {
                    if (appData.chores[i].id === id) {
                        chore = appData.chores[i];
                        break;
                    }
                }
                
                if (chore) {
                    var member = null;
                    for (var i = 0; i < appData.familyMembers.length; i++) {
                        if (appData.familyMembers[i].id === chore.assigneeId) {
                            member = appData.familyMembers[i];
                            break;
                        }
                    }
                    
                    if (member) {
                        member.totalChores--;
                        if (chore.completed) {
                            member.completedChores--;
                        }
                    }
                }
                
                appData.chores = appData.chores.filter(function(c) {
                    return c.id !== id;
                });
                
                updateStats();
                renderChores();
                renderFamilyMembers();
                checkWeeklyCompletion();
            }
        }

        function addNotification(title, message, type, photo) {
            var notification = {
                id: Date.now(),
                title: title,
                message: message,
                type: type,
                photo: photo || null,
                timestamp: new Date()
            };
            
            appData.notifications.unshift(notification);
            
            if (appData.notifications.length > 50) {
                appData.notifications = appData.notifications.slice(0, 50);
            }
            
            renderNotifications();
            
            if (appData.userRole === 'parent' && type === 'completion') {
                showNotifications();
                setTimeout(hideNotifications, 3000);
            }
        }

        function renderNotifications() {
            if (!elements.notificationsList) return;
            
            if (appData.notifications.length === 0) {
                elements.notificationsList.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">No notifications yet</div>';
                return;
            }

            var html = '';
            for (var i = 0; i < appData.notifications.length; i++) {
                var notification = appData.notifications[i];
                html += '<div class="notification-item">' +
                    '<div class="notification-title">' + notification.title + '</div>' +
                    '<div class="notification-message">' + notification.message + '</div>' +
                    (notification.photo ? '<img src="' + notification.photo + '" style="width: 100%; max-width: 200px; border-radius: 8px; margin-top: 10px;" alt="Completion photo">' : '') +
                    '<div class="notification-time">' + formatTime(notification.timestamp) + '</div>' +
                    '</div>';
            }
            elements.notificationsList.innerHTML = html;
        }

        function toggleNotifications() {
            if (elements.notificationsPanel.style.display === 'block') {
                hideNotifications();
            } else {
                showNotifications();
            }
        }

        function showNotifications() {
            if (elements.notificationsPanel) {
                elements.notificationsPanel.style.display = 'block';
            }
        }

        function hideNotifications() {
            if (elements.notificationsPanel) {
                elements.notificationsPanel.style.display = 'none';
            }
        }

        function updateStats() {
            var totalChores = appData.chores.length;
            var completedChores = 0;
            var overdueChores = 0;
            var now = new Date();
            
            for (var i = 0; i < appData.chores.length; i++) {
                if (appData.chores[i].completed) {
                    completedChores++;
                } else if (new Date(appData.chores[i].dueDate) < now) {
                    overdueChores++;
                }
            }
            
            if (elements.totalChores) elements.totalChores.textContent = totalChores;
            if (elements.completedChores) elements.completedChores.textContent = completedChores;
            if (elements.overdueChores) elements.overdueChores.textContent = overdueChores;
            if (elements.familyMembers) elements.familyMembers.textContent = appData.familyMembers.length;
        }

        function renderFamilyMembers() {
            if (!elements.familyMembersList) return;
            
            if (appData.familyMembers.length === 0) {
                elements.familyMembersList.innerHTML = '<div class="empty-state"><h3>No family members added yet</h3><p>Add family members to get started</p></div>';
                return;
            }

            var html = '';
            for (var i = 0; i < appData.familyMembers.length; i++) {
                var member = appData.familyMembers[i];
                var rate = member.totalChores > 0 ? Math.round((member.completedChores / member.totalChores) * 100) : 0;
                
                html += '<div class="member-card">' +
                    '<div class="member-header">' +
                    '<div>' +
                    '<div class="member-role">' + 
                    (member.role === 'parent' ? 'Parent Admin' : 'Child') + 
                    '</div>' +
                    '<div class="member-name">' + member.name + '</div>' +
                    (member.email ? '<div style="font-size: 0.8em; color: #666;">📧 ' + member.email + '</div>' : '') +
                    '</div>' +
                    (appData.isAdmin ? '<button class="btn btn-small btn-danger" onclick="removeFamilyMember(' + member.id + ')">Remove</button>' : '') +
                    '</div>' +
                    '<div class="member-stats">' +
                    '<span>Total: ' + member.totalChores + '</span>' +
                    '<span>Done: ' + member.completedChores + '</span>' +
                    '<span>Rate: ' + rate + '%</span>' +
                    '</div>' +
                    '</div>';
            }
            elements.familyMembersList.innerHTML = html;
        }

        function renderChores() {
            if (!elements.choresList) return;
            
            if (appData.chores.length === 0) {
                elements.choresList.innerHTML = '<div class="empty-state"><h3>No chores assigned yet</h3><p>Add some chores to get started</p></div>';
                return;
            }

            var filteredChores = appData.chores;
            if (appData.userRole === 'child') {
                filteredChores = [];
                var currentUser = null;
                for (var i = 0; i < appData.familyMembers.length; i++) {
                    if (appData.familyMembers[i].role === 'child') {
                        currentUser = appData.familyMembers[i];
                        break;
                    }
                }
                
                if (currentUser) {
                    for (var i = 0; i < appData.chores.length; i++) {
                        if (appData.chores[i].assigneeId === currentUser.id) {
                            filteredChores.push(appData.chores[i]);
                        }
                    }
                }
            }

            filteredChores.sort(function(a, b) {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                return new Date(a.dueDate) - new Date(b.dueDate);
            });

            var html = '';
            var now = new Date();
            
            for (var i = 0; i < filteredChores.length; i++) {
                var chore = filteredChores[i];
                var choreDateTime = new Date(chore.dueDate + 'T' + (chore.startTime || '09:00'));
                var isOverdue = !chore.completed && now > choreDateTime;
                var dueDate = new Date(chore.dueDate).toLocaleDateString();
                
                var classes = 'chore-item';
                if (chore.completed) classes += ' completed';
                if (isOverdue) classes += ' overdue';
                
                html += '<div class="' + classes + '">' +
                    '<div class="chore-title">' + chore.title + '</div>' +
                    '<div class="chore-meta">' +
                    '<span>👤 ' + chore.assigneeName + '</span>' +
                    '<span>📅 ' + dueDate + '</span>' +
                    '<span>⏰ ' + chore.startTime + '</span>' +
                    '<span>🔥 ' + chore.priority + '</span>' +
                    (chore.completed ? '<span>✅ Done</span>' : '') +
                    (isOverdue ? '<span style="color: #ff6b6b;">⚠️ Overdue</span>' : '') +
                    '</div>' +
                    (chore.completionPhoto ? '<img src="' + chore.completionPhoto + '" class="completion-photo" alt="Completion photo">' : '') +
                    '<div class="chore-actions">';
                
                if (appData.userRole === 'child' && !chore.completed) {
                    html += '<button class="btn btn-small btn-photo" onclick="takeCompletionPhoto(' + chore.id + ')">📸 Complete with Photo</button>';
                } else if (appData.isAdmin) {
                    html += '<button class="btn btn-small ' + (chore.completed ? 'btn-success' : '') + '" onclick="toggleChore(' + chore.id + ')">' +
                        (chore.completed ? 'Mark Incomplete' : 'Mark Complete') + '</button>';
                }
                
                if (appData.isAdmin) {
                    html += '<button class="btn btn-small btn-danger" onclick="deleteChore(' + chore.id + ')">Delete</button>';
                }
                
                html += '</div></div>';
            }
            
            elements.choresList.innerHTML = html;
        }

        function updateAssigneeDropdown() {
            if (!elements.choreAssignee) return;
            
            var html = '<option value="">Select child to assign chore</option>';
            for (var i = 0; i < appData.familyMembers.length; i++) {
                if (appData.familyMembers[i].role === 'child') {
                    html += '<option value="' + appData.familyMembers[i].id + '">' + appData.familyMembers[i].name + '</option>';
                }
            }
            elements.choreAssignee.innerHTML = html;
        }

        function checkWeeklyCompletion() {
            var now = new Date();
            var startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - now.getDay());
            startOfWeek.setHours(0, 0, 0, 0);
            
            var weeklyChores = [];
            for (var i = 0; i < appData.chores.length; i++) {
                var choreDate = new Date(appData.chores[i].dueDate);
                if (choreDate >= startOfWeek && choreDate <= now) {
                    weeklyChores.push(appData.chores[i]);
                }
            }
            
            var completedWeeklyChores = [];
            for (var i = 0; i < weeklyChores.length; i++) {
                if (weeklyChores[i].completed) {
                    completedWeeklyChores.push(weeklyChores[i]);
                }
            }
            
            var progressPercentage = weeklyChores.length > 0 ? 
                Math.round((completedWeeklyChores.length / weeklyChores.length) * 100) : 0;
            
            if (elements.weekProgressFill) {
                elements.weekProgressFill.style.width = progressPercentage + '%';
            }
            if (elements.weekProgressText) {
                elements.weekProgressText.textContent = 
                    progressPercentage + '% Complete (' + completedWeeklyChores.length + '/' + weeklyChores.length + ' chores)';
            }
            
            if (weeklyChores.length > 0 && completedWeeklyChores.length === weeklyChores.length) {
                showCelebration();
            }
        }

        function showCelebration() {
            for (var i = 0; i < appData.familyMembers.length; i++) {
                addNotification(
                    '🎉 Weekly Goal Achieved!',
                    'Congratulations ' + appData.familyMembers[i].name + '! All weekly chores are complete!',
                    'celebration'
                );
            }
            
            alert('🎉 Congratulations! All weekly chores have been completed! Great teamwork! 🌟');
        }

        function formatTime(date) {
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        window.toggleChore = toggleChore;
        window.takeCompletionPhoto = takeCompletionPhoto;
        window.removeFamilyMember = removeFamilyMember;
        window.deleteChore = deleteChore;

        function init() {
            var today = new Date().toISOString().split('T')[0];
            if (elements.choreDueDate) {
                elements.choreDueDate.value = today;
            }
            
            setupEventListeners();
            updateStats();
            renderFamilyMembers();
            renderChores();
            updateAssigneeDropdown();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>