<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Family Chore Manager</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Chore Manager">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 428px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 60px 20px 30px 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .main-content {
            padding: 20px;
            padding-bottom: 100px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            background: white;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
            touch-action: manipulation;
        }

        .btn:active {
            transform: scale(0.98);
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        .role-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        .hidden {
            display: none !important;
        }

        .info-box {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            font-size: 0.9em;
            color: #666;
        }

        .invite-section {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .invite-section h3 {
            margin-bottom: 15px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>üè† Family Chores</h1>
            <p>Smart chore management for busy families</p>
        </div>

        <div class="main-content">
            <!-- Role Selection -->
            <div class="section" id="roleSection">
                <h2 class="section-title">Choose Your Role</h2>
                <div class="form-row">
                    <button class="btn" onclick="setUserRole('parent')">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Parent Admin</button>
                    <button class="btn" onclick="setUserRole('child')">üë∂ Child</button>
                </div>
                <div class="info-box">
                    <strong>Note:</strong> Only Parent Admins can invite other family members and manage chores. Children can only complete assigned chores.
                </div>
            </div>

            <!-- Invite Section (Parent Only) -->
            <div class="section hidden" id="inviteSection">
                <h2 class="section-title">Invite Family Members</h2>
                
                <div class="invite-section">
                    <h3>üë∂ Invite a Child</h3>
                    <div class="form-group">
                        <input type="text" id="childName" placeholder="Child's name" />
                    </div>
                    <div class="form-group">
                        <input type="tel" id="childPhone" placeholder="Child's phone number" />
                    </div>
                    <button class="btn" onclick="sendChildInvite()">üì± Send Child Invitation</button>
                    <div style="margin-top: 10px; font-size: 0.85em; color: #666;">
                        Child will be automatically assigned the "Child" role and their first chore will be to install the app
                    </div>
                </div>

                <div class="invite-section">
                    <h3>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Invite Another Parent Admin</h3>
                    <div class="form-group">
                        <input type="text" id="parentName" placeholder="Parent's name" />
                    </div>
                    <div class="form-group">
                        <input type="tel" id="parentPhone" placeholder="Parent's phone number" />
                    </div>
                    <button class="btn" onclick="sendParentInvite()">üì± Send Parent Invitation</button>
                    <div style="margin-top: 10px; font-size: 0.85em; color: #666;">
                        Parent will have full admin access to manage chores and family
                    </div>
                </div>
            </div>

            <!-- Test Status -->
            <div class="section">
                <h2 class="section-title">App Status</h2>
                <div id="statusDisplay" style="padding: 20px; background: #f8f9fa; border-radius: 12px;">
                    App loaded successfully! Buttons should be working now.
                </div>
            </div>
        </div>

        <!-- Role Indicator -->
        <div class="role-indicator" id="roleIndicator">
            Current Role: <span id="currentRole"></span>
        </div>
    </div>

    <script>
        console.log('Script started loading...');

        // Simple app data
        var appData = {
            userRole: null,
            isAdmin: false,
            familyMembers: [],
            chores: []
        };

        // Test function to verify JavaScript is working
        function testFunction() {
            console.log('Test function called successfully!');
            alert('JavaScript is working!');
        }

        // Set user role
        function setUserRole(role) {
            console.log('setUserRole called with:', role);
            
            appData.userRole = role;
            appData.isAdmin = (role === 'parent');
            
            // Hide role selection
            var roleSection = document.getElementById('roleSection');
            if (roleSection) {
                roleSection.classList.add('hidden');
            }
            
            // Show role indicator
            var roleIndicator = document.getElementById('roleIndicator');
            if (roleIndicator) {
                roleIndicator.style.display = 'block';
            }
            
            var currentRoleSpan = document.getElementById('currentRole');
            if (currentRoleSpan) {
                currentRoleSpan.textContent = role === 'parent' ? 'Parent Admin' : 'Child';
            }
            
            // Show invite section for parents
            if (role === 'parent') {
                var inviteSection = document.getElementById('inviteSection');
                if (inviteSection) {
                    inviteSection.classList.remove('hidden');
                }
            }
            
            // Update status
            var statusDisplay = document.getElementById('statusDisplay');
            if (statusDisplay) {
                statusDisplay.innerHTML = 'Role set to: <strong>' + (role === 'parent' ? 'Parent Admin' : 'Child') + '</strong><br>Buttons are working correctly!';
            }
            
            alert('Welcome! You are now logged in as: ' + (role === 'parent' ? 'Parent Admin' : 'Child'));
        }

        // Send child invite
        function sendChildInvite() {
            console.log('sendChildInvite called');
            
            var nameInput = document.getElementById('childName');
            var phoneInput = document.getElementById('childPhone');
            
            var name = nameInput ? nameInput.value.trim() : '';
            var phone = phoneInput ? phoneInput.value.trim() : '';
            
            if (!name) {
                alert('Please enter the child\'s name');
                return;
            }
            
            if (!phone) {
                alert('Please enter the child\'s phone number');
                return;
            }
            
            // Add child immediately to family
            var childMember = {
                id: Date.now(),
                name: name,
                role: 'child',
                status: 'invited',
                phone: phone
            };
            
            appData.familyMembers.push(childMember);
            
            // Create invite message
            var appUrl = window.location.origin + window.location.pathname;
            var inviteUrl = appUrl + '?invite=' + childMember.id + '&role=child&name=' + encodeURIComponent(name);
            
            var message = 'Hi ' + name + '! üè†\n\n' +
                'You\'ve been invited to join our Family Chore Manager! \n\n' +
                'Click this link to get started: ' + inviteUrl + '\n\n' +
                'Your first chore will be to install the app on your phone\'s home screen. Easy! üì±\n\n' +
                'From: Family Chore Manager';
            
            // Try to open SMS
            var smsUrl = 'sms:' + phone.replace(/[^\d+]/g, '') + '?&body=' + encodeURIComponent(message);
            
            try {
                window.location.href = smsUrl;
                
                // Clear form
                if (nameInput) nameInput.value = '';
                if (phoneInput) phoneInput.value = '';
                
                alert('Invitation sent to ' + name + '! üéâ\n\n' +
                    '‚úÖ ' + name + ' has been added to your family\n' +
                    '‚úÖ They will get a text with the app link\n' +
                    '‚úÖ Their first chore will be to install the app\n\n' +
                    'Total family members: ' + appData.familyMembers.length);
                
            } catch (error) {
                alert('Could not open SMS app. Please manually send this message to ' + name + ':\n\n' + message);
            }
        }

        // Send parent invite
        function sendParentInvite() {
            console.log('sendParentInvite called');
            
            var nameInput = document.getElementById('parentName');
            var phoneInput = document.getElementById('parentPhone');
            
            var name = nameInput ? nameInput.value.trim() : '';
            var phone = phoneInput ? phoneInput.value.trim() : '';
            
            if (!name) {
                alert('Please enter the parent\'s name');
                return;
            }
            
            if (!phone) {
                alert('Please enter the parent\'s phone number');
                return;
            }
            
            // Create invite message
            var appUrl = window.location.origin + window.location.pathname;
            var inviteUrl = appUrl + '?invite=' + Date.now() + '&role=parent&name=' + encodeURIComponent(name);
            
            var message = 'Hi ' + name + '! üë®‚Äçüë©‚Äçüëß‚Äçüë¶\n\n' +
                'You\'ve been invited to be a Parent Admin for our Family Chore Manager!\n\n' +
                'Click this link to join: ' + inviteUrl + '\n\n' +
                'As a Parent Admin, you\'ll be able to:\n' +
                '‚Ä¢ Create and assign chores\n' +
                '‚Ä¢ Invite family members\n' +
                '‚Ä¢ Track completion with photos\n\n' +
                'From: Family Chore Manager';
            
            // Try to open SMS
            var smsUrl = 'sms:' + phone.replace(/[^\d+]/g, '') + '?&body=' + encodeURIComponent(message);
            
            try {
                window.location.href = smsUrl;
                
                // Clear form
                if (nameInput) nameInput.value = '';
                if (phoneInput) phoneInput.value = '';
                
                alert('Parent Admin invitation sent to ' + name + '! üéâ');
                
            } catch (error) {
                alert('Could not open SMS app. Please manually send this message to ' + name + ':\n\n' + message);
            }
        }

        // Check for invite codes on load
        function checkForInviteCode() {
            var urlParams = new URLSearchParams(window.location.search);
            var inviteCode = urlParams.get('invite');
            var role = urlParams.get('role');
            var name = urlParams.get('name');
            
            if (inviteCode && role && name) {
                // Automatically set role for invited users
                setUserRole(role);
                
                if (role === 'child') {
                    setTimeout(function() {
                        alert('Welcome ' + name + '! üéâ\n\n' +
                            'Your first chore is to:\n' +
                            '1. Tap the Share button in Safari\n' +
                            '2. Select "Add to Home Screen"\n' +
                            '3. Name it "Family Chores"\n' +
                            '4. Take a photo of your home screen showing the new app\n' +
                            '5. Complete the chore with that photo!');
                    }, 1000);
                }
                return true;
            }
            return false;
        }

        // Initialize app
        function init() {
            console.log('App initializing...');
            
            // Check for invite codes first
            checkForInviteCode();
            
            console.log('App initialized successfully');
        }

        // Start app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        console.log('Script loaded successfully');
    </script>
</body>
</html>